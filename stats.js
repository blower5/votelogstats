"use strict";

var defaultlog = 
`·°o_O Votes by Entry 0_o°·

==| sean - feline facility.mp3
5.000 - sulkaritari x3.42 INF
6.000 - Viraxor x3.2 INF
4.000 - Beej x2.1 INF
6.000 - Frag x2.6 INF
6.000 - cabbage drop x2.87 INF
5.000 - TristEndo x3.09 INF
7.000 - damifortune x2.98 INF
5.000 - hanna x3.53 INF
5.000 - kilowatt64 x2.43 INF
4.000 - tree x3.86 INF
2.000 - kleeder x3.2 INF
2.000 - mirageofher x4.08 INF

==| TristEndo - carnivalJam.mp3
6.000 - sulkaritari x3.42 INF
6.000 - Viraxor x3.2 INF
5.000 - Beej x2.1 INF
5.000 - Frag x2.6 INF
5.000 - cabbage drop x2.87 INF
5.000 - damifortune x2.98 INF
4.000 - hanna x3.53 INF
6.000 - kilowatt64 x2.43 INF
3.000 - tree x3.86 INF
3.000 - kleeder x3.2 INF
3.000 - mirageofher x4.08 INF

==| kleeder - participated.mp3
5.000 - sulkaritari x3.42 INF
6.000 - Beej x2.1 INF
6.000 - Frag x2.6 INF
7.000 - Viraxor x3.2 INF
6.000 - cabbage drop x2.87 INF
5.000 - TristEndo x3.09 INF
6.000 - damifortune x2.98 INF
5.000 - hanna x3.53 INF
5.000 - tree x3.86 INF
7.000 - kilowatt64 x2.43 INF
5.000 - mirageofher x4.08 INF

==| cabbage drop - midnight horse.mp3
5.000 - sulkaritari x3.42 INF
4.000 - Beej x2.1 INF
5.000 - Frag x2.6 INF
5.000 - Viraxor x3.2 INF
4.000 - TristEndo x3.09 INF
5.000 - damifortune x2.98 INF
4.000 - hanna x3.53 INF
3.000 - tree x3.86 INF
2.000 - kleeder x3.2 INF
5.000 - kilowatt64 x2.43 INF
4.000 - mirageofher x4.08 INF

==| hanna - sippycup.mp3
7.000 - sulkaritari x3.42 INF
7.000 - Beej x2.1 INF
6.000 - Frag x2.6 INF
5.000 - Viraxor x3.2 INF
7.000 - cabbage drop x2.87 INF
5.000 - TristEndo x3.09 INF
5.000 - damifortune x2.98 INF
4.000 - tree x3.86 INF
4.000 - kleeder x3.2 INF
7.000 - kilowatt64 x2.43 INF
4.000 - mirageofher x4.08 INF

==| sulkaritari - studious toad.mp3
6.000 - Frag x2.6 INF
7.000 - Beej x2.1 INF
5.000 - Viraxor x3.2 INF
6.000 - cabbage drop x2.87 INF
6.000 - TristEndo x3.09 INF
7.000 - damifortune x2.98 INF
6.000 - hanna x3.53 INF
5.000 - tree x3.86 INF
6.000 - kleeder x3.2 INF
7.000 - kilowatt64 x2.43 INF
6.000 - mirageofher x4.08 INF

==| tree - ew no.mp3
6.000 - sulkaritari x3.42 INF
7.000 - Frag x2.6 INF
6.000 - Beej x2.1 INF
4.000 - Viraxor x3.2 INF
5.000 - cabbage drop x2.87 INF
6.000 - TristEndo x3.09 INF
6.000 - damifortune x2.98 INF
5.000 - hanna x3.53 INF
3.000 - kleeder x3.2 INF
4.000 - kilowatt64 x2.43 INF
5.000 - mirageofher x4.08 INF

==| Beej - freefall.mp3
7.000 - sulkaritari x3.42 INF
6.000 - Frag x2.6 INF
7.000 - Viraxor x3.2 INF
6.000 - cabbage drop x2.87 INF
5.000 - TristEndo x3.09 INF
5.000 - damifortune x2.98 INF
7.000 - hanna x3.53 INF
4.000 - tree x3.86 INF
4.000 - kleeder x3.2 INF
5.000 - kilowatt64 x2.43 INF
5.000 - mirageofher x4.08 INF

==| damifortune - you cant just put distortion on every channel includign th e.mp3
6.000 - sulkaritari x3.42 INF
6.000 - Frag x2.6 INF
7.000 - Beej x2.1 INF
6.000 - cabbage drop x2.87 INF
6.000 - TristEndo x3.09 INF
6.000 - Viraxor x3.2 INF
6.000 - hanna x3.53 INF
7.000 - tree x3.86 INF
5.000 - kleeder x3.2 INF
6.000 - kilowatt64 x2.43 INF
7.000 - mirageofher x4.08 INF

==| kilowatt64 - alight.mp3
6.000 - sulkaritari x3.42 INF
6.000 - Frag x2.6 INF
5.000 - cabbage drop x2.87 INF
6.000 - TristEndo x3.09 INF
7.000 - Viraxor x3.2 INF
6.000 - damifortune x2.98 INF
6.000 - hanna x3.53 INF
6.000 - Beej x2.1 INF
5.000 - tree x3.86 INF
6.000 - kleeder x3.2 INF
7.000 - mirageofher x4.08 INF

==| mirageofher - waterfall book.mp3
6.000 - sulkaritari x3.42 INF
6.000 - cabbage drop x2.87 INF
7.000 - TristEndo x3.09 INF
6.000 - Viraxor x3.2 INF
5.000 - damifortune x2.98 INF
5.000 - Beej x2.1 INF
6.000 - hanna x3.53 INF
5.000 - tree x3.86 INF
6.000 - kleeder x3.2 INF
7.000 - kilowatt64 x2.43 INF




,| tally compiled 2023-06-03 12:33:10`;

// function go() {
//     parseData();
// }
function parseAndGraph(votelog) {
    clearRows();

    var entriesarrayunclean, entriesarrayclean;
    [entriesarrayunclean, entriesarrayclean] = parseData(votelog);

    addHeaderRow();
    for (let i in entriesarrayclean) {
        addStatRow(entriesarrayunclean[i],entriesarrayclean[i]);
    }
}

function parseData(votelog) {
    var inputByEntriesOnly = votelog.substring(votelog.search(/·°o_O Votes by Entry 0_o°·/) + 31, votelog.search(/\,\x7c tally compiled/));
    var entriesarray = inputByEntriesOnly.split("==|");
    for (let i in entriesarray) {
        entriesarray[i] = entriesarray[i].split("\n");
        //remove blank lines
        var temparraylength = entriesarray[i].length;
        for (let j in entriesarray[i]) {
            if (entriesarray[i][temparraylength-j] == "") entriesarray[i].splice(temparraylength-j,1);
        }
    }
    
    //isolate the votes TODO: voter influence is discarded
    var entriesarraynumbersonly = structuredClone(entriesarray);
    for (let i in entriesarraynumbersonly) {
        //remove top entry, which is not a vote
        entriesarraynumbersonly[i].splice(0,1);
        for (let j in entriesarraynumbersonly[i]) {
            entriesarraynumbersonly[i][j] = entriesarraynumbersonly[i][j].slice(0,5);
        }
    }
    return [entriesarray,entriesarraynumbersonly];
}

function addHeaderRow() {
    var tr = document.createElement('tr');
    
    function createth(content,className) {
        let th = document.createElement('th')
        th.textContent = content;
        return th;
    }
    tr.appendChild(createth("Entry"));
    tr.appendChild(createth("x̄"));
    tr.appendChild(createth("σ"));
    document.getElementById('entrytable').appendChild(tr);
}

function addStatRow(arrayunclean,arrayclean) {
    //calculate stats
    var mean   =   smathmean(arrayclean).toFixed(3);
    var stdevp = smathstdevp(arrayclean).toFixed(3);
    //manage graphics

    //add elements
    function createtd(content,className) {
        let td = document.createElement('td')
        td.textContent = content;
        td.className = className; 
        return td;
    }

    var tr = document.createElement('tr');
    
    tr.appendChild( createtd(arrayunclean[0], "tdname"  ) );
    tr.appendChild( createtd(mean           , "tdmean"  ) );
    tr.appendChild( createtd(stdevp         , "tdstdevp") );

    document.getElementById('entrytable').appendChild(tr);
}

function clearRows() {
    document.getElementById('entrytable').innerHTML = "";
}